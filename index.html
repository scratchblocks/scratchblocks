<!DOCTYPE html>
<meta charset="utf8">
<title>[scratchblocks]</title>

<meta name="viewport" content="width=device-width">

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
</script>

<link rel="stylesheet" href="scratchblocks2.css">
<script src="scratchblocks2.js"></script>
<script src="translations-all.js" charset="utf8"></script>

<style>
textarea, #link-url, #preview {
  box-sizing: border-box;
}
h1 {
  font-family: monospace;
  font-size: 1.5em;
}
a {
  text-decoration: none;
  color: #008;
}
a:hover {
  text-decoration: underline;
}
body {
  margin: 1em 2em;
  font-family: sans-serif;
}
input, button {
  font-size: 1em;
  font-family: inherit;
}
textarea {
  font-size: 1em;
  margin-bottom: 1em;
  width: 100%;
  max-width: 60em;
  min-height: 10em;
  height: 15em;
}
button {
  display: inline-block;
  font-size: 1.25em;
  margin-bottom: 1em;
  border: 1px solid #444;
  background: #ccc;
  box-shadow: 0 1px 1px #888;
}
a:active, button:active {
  position: relative;
  top: 1px;
  box-shadow: none;
}
#preview {
  margin: 1em 0;
  width: 100%;
  overflow: scroll;
  padding-bottom: 1.5em;
}
#link-url {
  width: auto;
  width: 30em;
  max-width: 100%;
  cursor: text;
}
label {
  font-weight: bold;
  cursor: pointer;
}
</style>



<h1>[scratchblocks]</h1>

<p><b>scratchblocks2</b> is a <a
  href="http://github.com/blob8108/scratchblocks2">plugin</a> that lets you
<b>write Scratch scripts</b> on the <a
href="http://scratch.mit.edu/discuss/">Scratch Forums</a> and <a
href="http://wiki.scratch.mit.edu/">Scratch Wiki</a>.

<p>For help, see the <a
  href="http://wiki.scratch.mit.edu/wiki/Block_Plugin/Syntax">article on
syntax</a>.

<p>To save on typing, you can <a href="generator/">generate code</a> straight
from your 2.0 projects.

<p><b>NEW:</b> <a href="diff/">Compare Scratch projects</a>.
</p>

<textarea id="code"></textarea>

<div>
  <button id="render">Render</button>
  <button id="clear">Clear</button>

  <select id="choose-lang">
    <option value="">Choose extra language...
    <option value="de"> Deutsch (German)
    <option value="es"> Español (Spanish)
    <option value="fr"> Français (French)
    <option value="zh_CN"> 中文 (Simplified Chinese)
    <option value="pl"> Polski (Polish)
    <option value="ja"> 日本語 (Japanese)
    <option value="nl"> Nederlands (Dutch)
    <option value="pt"> Português (Portugese)
    <option value="it"> Italiano (Italian)
    <option value="he"> עברית (Hebrew)
    <option value="ko"> 한국어 (Korean)
    <option value="nb">Norsk (Norwegian Bokmål) †
    <option value="tr">Türkçe (Turkish)
    <option value="el"> Ελληνικά (Greek)
    <option value="ru"> Pусский (Russian)
    <option value="ca"> Català (Catalan)
    <option value="id">Indonesia (Indonesian)
    <option>———
    <option value="an"> Aragonés (Aragonese)
    <option value="ar"> العربية (Arabic)
    <option value="ast"> Asturianu (Asturian) †
    <option value="bg"> Български (Bulgarian)
    <option value="bn_IN"> বাংলা (Bengali) †
    <option value="cs"> Čeština (Czech)
    <option value="cy"> Cymraeg (Welsh)
    <option value="da"> Dansk (Danish)
    <option value="eo"> Esperanto (Esperanto)
    <option value="et"> Eesti (Estonian)
    <option value="eu"> Euskara (Basque)
    <option value="fa"> فارسی (Persian) *
    <option value="fi"> Suomi (Finnish)
    <option value="fil"> Filipino (Filipino) *
    <option value="fo"> Føroyskt (Faroese) *
    <option value="fr_CA"> Français Canadien (Canadian French) *
    <option value="ga"> Gaeilge (Irish) †
    <option value="gl"> Galego (Galician)
    <option value="hch"> Wixárika (Huichol) *
    <option value="hi"> हिन्दी (Hindi)
    <option value="hr"> Hrvatski (Croatian)
    <option value="ht"> Kreyòl ayisyen (Haitian) *
    <option value="hu"> Magyar (Hungarian)
    <option value="hy"> Հայերեն (Armenian)
    <option value="is"> Íslenska (Icelandic)
    <option value="ja_HIRA"> にほんご (Japanese Hiragana)
    <option value="kk"> Қазақша (Kazakh) *
    <option value="km"> ភាសាខ្មែរ (Khmer) *
    <option value="kn"> ಕನ್ನಡ (Kannada)
    <option value="ku"> Kurdî / كوردی (Kurdish) *
    <option value="ky"> Кыргызча (Kyrgyz) †
    <option value="la"> Latina (Latin) *
    <option value="lt"> Lietuvių (Lithuanian)
    <option value="lv"> Latviešu (Latvian) †
    <option value="maz"> Jñatjo (Mazahua) *
    <option value="mk"> Македонски (Macedonian)
    <option value="ml"> മലയാളം (Malayalam) *
    <option value="mn"> Монгол (Mongolian) *
    <option value="mr"> मराठी (Marathi) *
    <option value="ms"> Bahasa Melayu (Malay) *
    <option value="my"> ဗမာစာ (Burmese)
    <option value="nah"> Nāhuatl (Nahuatl) *
    <option value="ne"> नेपाली (Nepali) *
    <option value="nn"> Nynorsk (Norwegian Nynorsk) †
    <option value="no"> Norsk (Norwegian)
    <option value="os"> Иронау (Ossetian) †
    <option value="ote"> Hñähñu (Mezquital Otomi) *
    <option value="oto"> Hñähñu (Otomi) *
    <option value="pap"> Idoma-Nòmber (Idoma) *
    <option value="pt_BR"> Português brasileiro (Brazilian Portuguese)
    <option value="ro"> Română (Romanian)
    <option value="rw"> Ikinyarwanda (Kinyarwanda) *
    <option value="sk"> Slovenčina (Slovak)
    <option value="sl"> Slovenščina (Slovene)
    <option value="sr"> Српски / Srpski (Serbian)
    <option value="sv"> Svenska (Swedish)
    <option value="sw"> Kiswahili (Swahili) *
    <option value="ta"> தமிழ் (Tamil) †
    <option value="th"> ไทย (Thai) *
    <option value="tzm"> Tamaziġt (Tamazight) †
    <option value="ug"> ئۇيغۇر تىلى (Uyghur) *
    <option value="uk"> Українська (Ukrainian)
    <option value="vi"> Tiếng Việt (Vietnamese)
    <option value="zh_TW"> 正體中文 (Traditional Chinese)
  </select>

  <small>(* = language is missing some blocks,
          † = language doesn't have Scratch 1.4 blocks)</small>
</div>

<div id="link">
  <label for="link-url" id="link-url-label">Link:</label>
  <input type="text" id="link-url" readonly>
</div>

<pre id="preview" class="blocks"></pre>

<script>
var ga;

var DEFAULT = "";

if(typeof(String.prototype.trim) === "undefined") {
  String.prototype.trim = function() {
    return String(this).replace(/^\s+|\s+$/g, '');
  };
}

code = document.getElementById('code');
preview = document.getElementById('preview');
link_url = document.getElementById('link-url');
link_url_label = document.getElementById('link-url-label');

var oldHash;

function refresh () {
  script = code.value;

  script = script.replace(/\[\/?scratchblocks\]/gi, '');  // Scratch Forums
  script = script.replace(/<\/?scratchblocks>/gi, '');  // Scratch Wiki
  script = script.replace(/^position\:[0-9\., ]+/i, '');  // Kurt
  script = script.trim();

  if (choose_lang.value) {
    location.hash = ('#?lang=' + encodeURIComponent(choose_lang.value) +
                     '&script='+encodeURIComponent(script));
  } else {
    location.hash = '#'+encodeURIComponent(script);
  }
  oldHash = location.hash;
  link_url.value = location;

  // empty preview
  var child;
  while (child = preview.lastChild) {
    preview.removeChild(child);
  }

  // add script
  preview.appendChild(document.createTextNode(script))

  scratchblocks2.parse("pre.blocks");

  if (ga !== undefined) {
    ga('send', 'event', 'render', 'render');
  }

  console.log("refreshed");
}

function checkHash() {
  if (oldHash != location.hash) {
    var hash = location.href.split('#')[1] || DEFAULT;
    if (/^\?/.test(hash)) {
      parts = hash.slice(1).split('&');
      parts.forEach(function(part) {
        var match = /^(.*)=(.*)$/.exec(part);
        if (!match) return;
        var key = decodeURIComponent(match[1]);
        var value = decodeURIComponent(match[2]);
        console.log(value);
        switch (key) {
          case "lang":
            choose_lang.value = value;
            break;
          case "script":
            code.value = value;
            break;
        }
      });
      choose_lang.onchange();
    } else {
      code.value = decodeURIComponent(hash);
    }
    refresh();
  }
  window.setTimeout(checkHash, 200);
}

document.getElementById('render').onclick = function () {
  if (ga !== undefined) {
    ga('send', 'event', 'button', 'click', 'Render button');
  }
  refresh();
}
code.onkeyup = refresh;
code.onblur = refresh;
code.oncopy = code.onpaste = function(e) {
  window.setTimeout(refresh, 100);
}


document.getElementById('clear').onclick = function () {
  code.value = "";
  refresh();
  code.focus();
}

link_url.onclick = link_url.onfocus = link_url_label.onclick = function(e) {
  link_url.focus();
  link_url.select();

  // Work around Chrome's little problem
  link_url.onmouseup = function() {
    // Prevent further mouseup intervention
    link_url.onmouseup = null;
    return false;
  };
}

var choose_lang = document.getElementById("choose-lang");
choose_lang.onchange = function (e) {
  var lang = choose_lang.value;
  scratchblocks2.reset_languages();
  var lang_dict = scratchblocks2._translations[lang];
  if (lang_dict) scratchblocks2.load_language(lang_dict)
  refresh(lang);
};
choose_lang.value = "";

checkHash();

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42663022-1', 'blob8108.github.io');
  ga('send', 'pageview');
</script>
